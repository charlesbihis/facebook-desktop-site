<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%" horizontalAlign="center">
	
	<mx:Metadata>
        [Event(name="cancelClicked", type="flash.events.Event")]
    </mx:Metadata>
	
	<mx:Script>
		<![CDATA[
			import mx.events.EffectEvent;
			import mx.rpc.events.FaultEvent;
			import mx.rpc.events.ResultEvent;
			import mx.utils.StringUtil;
			
			private function insertEmailRequest():void
			{
				emailAddress.enabled = false;
				
				// generate parameters
				var params:Object = new Object();
				params.email = StringUtil.trim(emailAddress.text);
				
				insertRequest.send(params);
			}  // insertEmailRequest
			
			private function resultHandler(event:ResultEvent):void
			{
				if (event.result as int > 0)
				{
					requestSuccess.play();
					requestSuccess.addEventListener(EffectEvent.EFFECT_END, cancelClicked);
				}  // if statement
				else
				{
					requestFailed.play();
					requestFailed.addEventListener(EffectEvent.EFFECT_END, reset);
					
					function reset(event:Event):void
					{
						emailAddress.enabled = true;
						resetFromFail.play();
					}  // reset
				}  // else statement
			}  // resultHandler
			
			private function faultHandler(event:FaultEvent):void
			{
				throw new Error(event.message);
			}  // faultHandler
			
			private function invalidEmail():void
			{
				requestFailed.play();
				requestFailed.addEventListener(EffectEvent.EFFECT_END, reset);
				
				function reset(event:Event):void
				{
					emailAddress.enabled = true;
					resetFromFail.play();
				}  // reset
			}  // invalidEmail
		
			private function cancelClicked(event:Event = null):void
			{
				emailAddress.enabled = true;
				emailAddress.text = "";
				successText.alpha = 0;
				enterEmailText.alpha = 1;
				cancelButton.alpha = 1;
				dispatchEvent(new Event("cancelClicked"));
			}  // cancelClicked
		]]>
	</mx:Script>
	
	<mx:HTTPService id="insertRequest" url="./insert-email.php" result="resultHandler(event)" fault="faultHandler(event)" method="POST" />

	<mx:Sequence id="requestSuccess">
		<mx:Fade targets="{[enterEmailText, cancelButton]}" duration="200" alphaFrom="1" alphaTo="0" />
		<mx:Parallel>
			<mx:Fade target="{successText}" alphaFrom="0" alphaTo="1" duration="250" />
			<mx:Move target="{successText}" yFrom="{successText.y + 5}" yTo="{successText.y}" duration="250" />
		</mx:Parallel>
		<mx:Fade target="{successText}" alphaFrom="1" alphaTo="1" duration="10000" />
	</mx:Sequence>
	
	<mx:Sequence id="requestFailed">
		<mx:Fade targets="{[enterEmailText, cancelButton]}" duration="200" alphaFrom="1" alphaTo="0" />
		<mx:Parallel>
			<mx:Fade target="{failText}" alphaFrom="0" alphaTo="1" duration="250" />
			<mx:Move target="{failText}" yFrom="{failText.y + 5}" yTo="{failText.y}" duration="250" />
		</mx:Parallel>
		<mx:Fade target="{failText}" alphaFrom="1" alphaTo="1" duration="2000" />
	</mx:Sequence>
	
	<mx:Sequence id="resetFromFail">
		<mx:Fade target="{failText}" alphaFrom="1" alphaTo="0" duration="200" />
		<mx:Fade targets="{[enterEmailText, cancelButton]}" duration="200" alphaFrom="0" alphaTo="1" />
	</mx:Sequence>
	
	<mx:EmailValidator source="{emailAddress}" property="text" 
       trigger="{emailAddress}" triggerEvent="enter"
       valid="insertEmailRequest()" invalid="invalidEmail()"/>
	
	<mx:TextInput id="emailAddress" enter="emailAddress.enabled=false"/>
	<mx:Canvas height="38">
		<mx:Label id="successText" text="Thanks!  As soon as we can accept more users, you'll be the first to know!" color="0x3b5998" fontFamily="Myriad Pro" fontSize="13" fontWeight="bold" alpha="0" top="0" horizontalCenter="0" />
		<mx:Label id="failText" text="Sorry, please enter a valid e-mail address" color="red" fontFamily="Myriad Pro" fontSize="13" fontWeight="bold" alpha="0" top="0" horizontalCenter="0" />
		<mx:Label id="enterEmailText" text="enter your e-mail to get your invite" color="0x444444" fontFamily="Myriad Pro" fontSize="11" top="0" horizontalCenter="0" />
		<mx:Text id="cancelButton" text="cancel" click="cancelClicked()" useHandCursor="true" fontSize="10" buttonMode="true" mouseChildren="false" color="0x777777" fontFamily="Myriad Pro" bottom="0" horizontalCenter="0" />
	</mx:Canvas>
	
</mx:VBox>
